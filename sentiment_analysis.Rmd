---
title: "Sentiment analysis - Svevo corpus of italian letters"
output: html_document
---

# Sentiment Analysis
Sentiment analysis of italian letter in Svevo Corpus.

```{r load dataset, warning = FALSE}
# load functions for sentiment analysis
source("sentiment/sentiment_functions.R")

# Load dataset with lemmatized words
corpus_ita <- read.csv("csv/cleaned_svevo_dataset_ITA.csv", sep=",", encoding = "UTF-8")

```


```{r}
library(tidyverse)
library(tidytext)
library(textdata)

document_words <- corpus_ita %>%
  unnest_tokens(word, tokens) %>%
  count(letter_number, word)

```

Summarise sentiments for all documents in our corpus:
```{r, warning = FALSE}
# assign positive-negative-neutral scores to all the documents
sentiment_docs <- get_sentiment(document_words, corpus_ita) #takes a little bit of time 
```


Analyze how sentiments evolved over time:

```{r plot sentiment trend over time}
#input: set of sentiments {positive, negative, neutral}
#output: their trend over time

library(dplyr)
library(ggplot2)
library(tidyr)

sentiment_labels <- c("neutral", "positive", "negative")

sum_sentiment <- sentiment_docs %>%
  group_by(date) %>%
  summarise(across(sentiment_labels, sum))

sum_sentiment <- sum_sentiment  %>% mutate(n = negative/(negative+positive+neutral))
sum_sentiment <- sum_sentiment  %>% mutate(p = positive/(negative+positive+neutral))
sum_sentiment <- sum_sentiment  %>% mutate(ne = neutral/(negative+positive+neutral))

sum_sentiment$negative <- sum_sentiment$n
sum_sentiment$positive <- sum_sentiment$p
sum_sentiment$neutral <- sum_sentiment$ne

sum_sentiment[, -((ncol(sum_sentiment) - 2):ncol(sum_sentiment))]



sum_sentiment %>%
   # gather(key, value, sentiment_labels) %>%
    ggplot() +
    geom_line(aes(x=date, y=neutral, colour="neutral", group = 1),ylab="")+
    geom_point(aes(x=date, y=neutral, colour="neutral", group = 1),ylab="") +
    geom_line(aes(x=date, y=negative, colour="negative", group = 1),ylab="")+
    geom_point(aes(x=date, y=negative, colour="negative", group = 1),ylab="")+
    geom_line(aes(x=date, y=positive, colour="positive", group = 1),ylab="")+
    geom_point(aes(x=date, y=positive, colour="positive", group = 1),ylab="") +
    scale_colour_manual(values = c("positive" = "#fcba03", "negative" = "#097aab", "neutral" = "black")) +
    labs( y = "") 

sum_sentiment %>%
  gather(key, value, sentiment_labels) %>%
  ggplot( aes(x = date, y = value, fill=key, group = 1),ylab="") +
  geom_bar(stat = "identity", position = "dodge") 

```

```{r plot sentiment trend over people}
#input: set of sentiments {positive, negative, neutral}
#output: their trend over people

library(dplyr)
library(ggplot2)
library(tidyr)

sentiment_labels <- c("neutral", "positive", "negative")

sum_sentiment <- sentiment_docs[,-1] %>%
  group_by(pair) %>%
  mutate(count = n()) %>%
  filter(count > 2) %>%
  group_by(pair, count) %>%
  summarise(across(sentiment_labels, sum)) 


sum_sentiment <- melt(sum_sentiment, id = c("pair", "count"))

sum_sentiment %>%
  ggplot() + 
  geom_bar(aes(x = pair, y = value/count, fill = variable), position = "dodge", stat = "identity")
```
