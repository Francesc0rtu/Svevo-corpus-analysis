---
title: "Sentiment analysis - Svevo corpus of italian letters"
output: html_document
---

# Sentiment Analysis
Sentiment analysis of italian letter in Svevo Corpus.

```{r load dataset, warning = FALSE}
# load functions for LDA analysis
# source("LDA/lda_functions.R")

# Load dataset with lemmatized words
corpus_ita <- read.csv("csv/cleaned_svevo_dataset_ITA.csv", sep=",", encoding = "UTF-8")

```


```{r}
library(tidyverse)
library(tidytext)
library(textdata)

get_sentiment <- function(doc, sentiment_df) {
  doc$sentiments <- "neutral"
  doc$polarity <- 0
  for(i in 1:length(doc$word)) {
    if(nrow(sentiment_df[which(sentiment_df$word == doc$word[i]),])){
      doc$sentiments[i] = sentiment_df[which(sentiment_df$word == doc$word[i]),][1,]$sentiment
      doc$polarity[i] = sentiment_df[which(sentiment_df$word == doc$word[i]),][1,]$polarity
    }
  }
  return(doc)
}

document_words <- corpus_ita %>%
  unnest_tokens(word, tokens) %>%
  count(letter_number, word)

# get sentiments
sentiment_df <- read.csv("csv/pos_neg_neu.csv",  sep=",", encoding = "UTF-8")


# for one document check words and look at how they are classified (positive or negative)
doc <- document_words %>% filter(letter_number == 22) 

doc <- get_sentiment(doc, sentiment_df)
doc$sentiments <- as.factor(doc$sentiments)
pos_neg <- doc[,4:5] %>% 
  group_by(sentiments)
  
res <- doc %>% 
  group_by(sentiments) %>% 
  summarise(polarity = sum(polarity)) %>%
  mutate(polarity = (polarity/sum(polarity)) * 100)

ggplot(res, aes(x="", y=polarity, fill=sentiments)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0)+
  theme_void() 


```